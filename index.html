<!DOCTYPE html>
<html>
<head>
  <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ mitmproxy</title>
  <style>
    body { background: #111; color: #0f0; font-family: monospace; padding: 30px; max-width: 800px; margin: auto; }
    label { font-weight: bold; font-size: 16px; display: block; margin-top: 20px; margin-bottom: 8px; }
    input[type="text"], textarea {
      width: 100%;
      font-size: 14px;
      padding: 8px;
      border-radius: 5px;
      border: none;
      outline: none;
      font-family: monospace;
      box-sizing: border-box;
      color: #0f0;
      background: #222;
      white-space: pre-wrap;
    }
    textarea {
      height: 200px;
      resize: vertical;
    }
    button {
      padding: 12px 24px;
      margin: 15px 10px 0 0;
      font-size: 18px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
    }
    button.enable { background-color: #0a0; color: white; }
    button.disable { background-color: #a00; color: white; }
    #status { margin-top: 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–º–µ–Ω–æ–π —á–µ—Ä–µ–∑ mitmproxy</h1>

  <label for="domainsInput">–î–æ–º–µ–Ω—ã –¥–ª—è –ø–æ–¥–º–µ–Ω—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, * ‚Äî –≤—Å–µ):</label>
  <input type="text" id="domainsInput" placeholder="example.com, example123.com, *" />

  <label for="ipInput">IP-–∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –≤–∫–ª—é—á–∏—Ç—å –ø–æ–¥–º–µ–Ω—É (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
  <input type="text" id="ipInput" placeholder="192.168.1.100, 203.0.113.45" />

  <label for="htmlInput">HTML-–∫–æ–¥ –¥–ª—è –ø–æ–¥–º–µ–Ω—ã:</label>
  <textarea id="htmlInput" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ HTML, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å"></textarea>

  <br/>

  <button class="enable" onclick="saveConfig(true)">‚úÖ –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥–º–µ–Ω—É</button>
  <button class="disable" onclick="saveConfig(false)">‚õî –í—ã–∫–ª—é—á–∏—Ç—å –ø–æ–¥–º–µ–Ω—É</button>

  <div id="status"></div>

<script>
  const GITHUB_TOKEN = "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";
  const REPO = "adamtuwima/bandana";
  const CONFIG_PATH = "config.json";
  const HTML_PATH = "replacement.html";
  const BRANCH = "main";

  async function getFileContent(path) {
    const apiURL = `https://api.github.com/repos/${REPO}/contents/${path}?ref=${BRANCH}`;
    const res = await fetch(apiURL, {
      headers: {
        "Authorization": `token ${GITHUB_TOKEN}`,
        "Accept": "application/vnd.github.v3+json"
      }
    });
    if (!res.ok) throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${path}: ` + res.status);
    return await res.json();
  }

  async function loadData() {
    try {
      const configData = await getFileContent(CONFIG_PATH);
      const config = JSON.parse(atob(configData.content));
      if (config.domains && Array.isArray(config.domains)) {
        document.getElementById("domainsInput").value = config.domains.join(", ");
      }
      if (config.active_servers && Array.isArray(config.active_servers)) {
        document.getElementById("ipInput").value = config.active_servers.join(", ");
      }
      const htmlData = await getFileContent(HTML_PATH);
      const htmlText = atob(htmlData.content);
      document.getElementById("htmlInput").value = htmlText;
      document.getElementById("status").textContent = "‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.";
    } catch (e) {
      document.getElementById("status").textContent = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: " + e.message;
    }
  }

  async function saveConfig(enabled) {
    const statusDiv = document.getElementById("status");
    statusDiv.textContent = "‚è≥ –°–æ—Ö—Ä–∞–Ω—è—é...";

    try {
      const configData = await getFileContent(CONFIG_PATH);
      const config = JSON.parse(atob(configData.content));
      const configSha = configData.sha;

      const htmlData = await getFileContent(HTML_PATH);
      const htmlSha = htmlData.sha;

      config.enabled = enabled;
      const domains = document.getElementById("domainsInput").value.split(",").map(s => s.trim()).filter(Boolean);
      config.domains = domains.length ? domains : ["*"];

      const ips = document.getElementById("ipInput").value.split(",").map(s => s.trim()).filter(Boolean);
      config.active_servers = ips.length ? ips : [];

      const htmlContent = document.getElementById("htmlInput").value;

      await fetch(`https://api.github.com/repos/${REPO}/contents/${CONFIG_PATH}`, {
        method: "PUT",
        headers: {
          "Authorization": `token ${GITHUB_TOKEN}`,
          "Accept": "application/vnd.github.v3+json"
        },
        body: JSON.stringify({
          message: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ config.json",
          content: btoa(JSON.stringify(config, null, 2)),
          sha: configSha,
          branch: BRANCH
        })
      });

      await fetch(`https://api.github.com/repos/${REPO}/contents/${HTML_PATH}`, {
        method: "PUT",
        headers: {
          "Authorization": `token ${GITHUB_TOKEN}`,
          "Accept": "application/vnd.github.v3+json"
        },
        body: JSON.stringify({
          message: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ replacement.html",
          content: btoa(unescape(encodeURIComponent(htmlContent))),
          sha: htmlSha,
          branch: BRANCH
        })
      });

      statusDiv.textContent = "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!";
    } catch (e) {
      statusDiv.textContent = "‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: " + e.message;
    }
  }

  window.onload = loadData;
</script>
</body>
</html>
